<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Frame Notation" /><meta name="author" content="Mark Truluck" /><meta property="og:locale" content="en_US" /><meta name="description" content="Frame System Notation (FSN) v0.3" /><meta property="og:description" content="Frame System Notation (FSN) v0.3" /><link rel="canonical" href="/notation/" /><meta property="og:url" content="/notation/" /><meta property="og:site_name" content="Frame" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-26T23:24:07+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Frame Notation" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Mark Truluck" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Mark Truluck"},"description":"Frame System Notation (FSN) v0.3","url":"/notation/","headline":"Frame Notation","@type":"BlogPosting","dateModified":"2024-05-26T23:24:07+08:00","datePublished":"2024-05-26T23:24:07+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/notation/"},"@context":"https://schema.org"}</script><title>Frame Notation | Frame</title><link rel="icon" href="/assets/img/favicons/favicon.png" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/page.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-VKPZ1VN8H2"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-VKPZ1VN8H2'); }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id={"id"=>"G-VKPZ1VN8H2", "pv"=>{"enabled"=>false, "proxy_url"=>"", "proxy_endpoint"=>"", "cache"=>false}}"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '{"id"=>"G-VKPZ1VN8H2", "pv"=>{"enabled"=>false, "proxy_url"=>"", "proxy_endpoint"=>"", "cache"=>false}}'); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div class="site-title mt-3"> <a href="/">Frame</a></div><div class="site-subtitle font-italic">A Software Architecture Language</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/resources/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>RESOURCES</span> </a><li class="nav-item active"> <a href="/notation/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>FRAME NOTATION</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://www.linkedin.com/in/marktruluck/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mark','frame-lang.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://github.com/frame-lang" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/">Home</a> </span> <span>Frame Notation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Frame Notation</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="page" class="post pb-5 pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4 mb-md-4"><h1 class="dynamic-title">Frame Notation</h1><div class="post-content"><h1 id="frame-system-notation-fsn-v03">Frame System Notation (FSN) v0.3</h1><p><strong>Frame System Notation</strong> (FSN) is a domain specific markdown language for defining the behavior of software (and other) systems. Frame technology generates both system controller code as well as corresponding documentation from a system specification document. Frame currently supports generating C#, C++, JavaScript and UML documentation.</p><h2 id="comments">Comments</h2><p>Comments are single line and indicated by three (3) dashes:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>--- this is a single line comment
--- as is this
</pre></table></code></div></div><h2 id="variable-and-parameter-declarations">Variable and Parameter Declarations</h2><p>Variables and parameter declarations share a core common syntax.</p><h3 id="parameter-declarations">Parameter Declarations</h3><p>Parameters are declared as follows and separated by whitespace:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>param:type
</pre></table></code></div></div><p>The name is required but the :type is optional. Parameter lists are one or more parameter declarations enclosed in brackets:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>[&lt;param_list&gt;]
</pre></table></code></div></div><p>Therefore parameter lists can be declared either of these two ways:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>[param1 param2]

--- or ---

[param1:type1 param2:type2]
</pre></table></code></div></div><h3 id="variable-declarations">Variable Declarations</h3><p>Variable and constant declarations have the following format:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>    &lt;var | const&gt; &lt;name&gt; : &lt;type_opt&gt; = &lt;intializer&gt;

    var x:int = 1
    const name = "Steve"
</pre></table></code></div></div><p>Variables can be modified after initialization and constants can not. Frame will transpile into the closest semantic equivalents in the target language.</p><p>The type is optional but the initializer is not.</p><p>If you transpile into a language that requires a type and you don’t provide one, a token such as <code class="language-plaintext highlighter-rouge">&lt;?&gt;</code> is substituted. Conversely, if you add a type and transpile into a language that doesn’t require one, the Framepiler ignores it.</p><h2 id="methods">Methods</h2><p>All methods (for all blocks) have a similar syntax:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>&lt;method-name&gt; &lt;parameters-opt&gt; &lt;return-value-opt&gt;

</pre></table></code></div></div><p>As implied above, the parameters and return value are optional. Here are the permutations for method declarations:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>method_name
method_name [param]
method_name [param:type]
method_name [param1 param2]
method_name [param1:type param2:type]
method_name : return_value
method_name [param1:type param2:type] : return_value
</pre></table></code></div></div><h2 id="whitespace-separators">Whitespace separators</h2><p>One important difference between Frame and other languages is the lack of any commas or semicolons as separators. Instead Frame relies on whitespace to delineate tokens:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>--- lists ---
[x y]
[x:int y:string]
(a b c)
(d() e() f())

--- statements ---

a() b() c()
var x:int = 1
</pre></table></code></div></div><p>Unlike other languages where structured whitespace is significant (e.g. Python), Frame’s use of whitespace is <i>unstructured</i>. Frame only separates tokens with whitespace and does not insist on any pattern of use.</p><p>The esthetic goal is to be as spare and clean as possible, but it may take some getting used to.</p><h2 id="lists">Lists</h2><p>List come in two flavors - <em>parameter lists</em> and <em>expression lists</em>.</p><p>Frame uses square brackets to denote parameter lists:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[x y]
[x:int y:string]
</pre></table></code></div></div><h2 id="system-controller-architecture">System Controller Architecture</h2><p>Now with the basics explained we can take a look at the big picture and work in.</p><p>The <code class="language-plaintext highlighter-rouge">#</code> token prefix tags an identifier as a <i>system</i>. the <code class="language-plaintext highlighter-rouge">##</code> token indicates the end of the system specification.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>#MySystemController
##
</pre></table></code></div></div><p>Currently Frame generates an object-oriented class for each system specification document. However, this does not preclude other ways to implement system controllers which will be an interesting research topic for the future.</p><p>Frame is highly opinionated about the internal structure of system controllers and currently specifies a composition of four sequential (but optional) “blocks”:</p><ol><li>Interface<li>State Machine<li>Actions<li>Domain</ol><p>Here is the syntax for these blocks:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#MySystemController
    -interface-
    -machine-
    -actions-
    -domain-
##  
</pre></table></code></div></div><p>Once again, there can be 0-4 blocks, but if present they must be in this order. Tying all of these together is the use of the FrameEvent which we will explore next.</p><h2 id="frame-events">Frame Events</h2><p>Frame Events are essential to the notation and the implementation of Frame system controllers. Frame notation assumes three mandatory fields for a FrameEvent:</p><ul><li>A <code class="language-plaintext highlighter-rouge">message</code> object (String, enumeration, other)<li>A <code class="language-plaintext highlighter-rouge">parameters</code> key/value lookup object<li>A <code class="language-plaintext highlighter-rouge">return</code> object</ul><p>Here is a basic implementation of this class:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">FrameEvent</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_message</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_parameters</span> <span class="p">=</span> <span class="n">parameters</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">_message</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="p">&gt;</span> <span class="n">_parameters</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Object</span> <span class="n">_return</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure><p>Frame notation uses the <code class="language-plaintext highlighter-rouge">@</code> symbol to identify a FrameEvent. Each of the three FrameEvent attributes has its own accessor symbol as well:</p><div class="table-wrapper"><table><thead><tr><th>Symbol<th>Meaning/Usage<tbody><tr><td>@<td>frameEvent<tr><td>@||<td>frameEvent._message<tr><td>@[]<td>frameEvent._parameters<tr><td>@[“foo”]<td>frameEvent._parameters[“foo”]<tr><td>@^<td>frameEvent._return<tr><td>^(value)<td>frameEvent._return = value; return;</table></div><p>Frame has six special reserved messages for important operations:</p><div class="table-wrapper"><table><thead><tr><th>Message Symbol<th>Meaning<th>Mandatory<tbody><tr><td>&gt;<td>Enter state<td>Yes<tr><td>&lt;<td>Exit state<td>Yes<tr><td>&gt;&gt;<td>Start system<td>No<tr><td>&lt;&lt;<td>Stop system<td>No<tr><td>&gt;&gt;&gt;<td>Save system<td>No<tr><td>&lt;&lt;&lt;<td>Restore system<td>No</table></div><p>The semantics of the <code class="language-plaintext highlighter-rouge">|&gt;|</code> and <code class="language-plaintext highlighter-rouge">|&lt;|</code> events are understood by the Framepiler and functionally supported. The remaining messages are optional may be unused or replaced by other messages with the same semantics if desired.</p><h2 id="interface-block">Interface Block</h2><p>The Interface Block contains a list of zero or more public methods with an optional <i>alias</i> annotation.</p><p>Here is a simple <code class="language-plaintext highlighter-rouge">#Dog</code> with a single public interface method:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#Dog

    -interface-

    speak
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Dog</span> <span class="p">{</span>

    <span class="c1">//===================== Interface Block ===================//</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">speak</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"speak"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure><p>This code snippet isn’t actually functional as it references a missing <code class="language-plaintext highlighter-rouge">_state_</code> variable which wasn’t generated. However it does show the most basic syntax for an interface method.</p><p>To get our <code class="language-plaintext highlighter-rouge">#Dog</code> to respond we can send it a text string of what we want it to say and return an AudioClip of <a href="https://www.youtube.com/watch?v=hiMjgLaN9cY" target="_blank">it’s attempt</a>:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#Dog

    -interface-

    speak [name:string] : AudioClip
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Dog</span> <span class="p">{</span>

    <span class="c1">//===================== Interface Block ===================//</span>

    <span class="k">public</span> <span class="n">AudioClip</span> <span class="nf">speak</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">parameters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;();</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>

        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"speak"</span><span class="p">,</span><span class="n">parameters</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">AudioClip</span><span class="p">)</span> <span class="n">e</span><span class="p">.</span><span class="n">Return</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure><h3 id="message-aliases">Message Aliases</h3><p>By default, Frame generates a message identical to the name of the interface method. In order to send a different message Frame supports the message alias syntax:</p><p><code class="language-plaintext highlighter-rouge">@(|substitute_msg|)</code></p><p>This can be used to change the messages that the interface sends to the state machine:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#SpanishDog

    -interface-

    speak [name:string] : AudioClip @(|hable|)
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SpanishDog</span> <span class="p">{</span>

    <span class="c1">//===================== Interface Block ===================//</span>

    <span class="k">public</span> <span class="n">AudioClip</span> <span class="nf">speak</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">parameters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;();</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>

        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"hable"</span><span class="p">,</span><span class="n">parameters</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">AudioClip</span><span class="p">)</span> <span class="n">e</span><span class="p">.</span><span class="n">Return</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure><p>As we can see interface methods do not provide any actual functionality. Instead, the interface simply transmits the message and parameters from the outside world to the system controller’s internal state machine. When the machine completes it’s activity the interface returns whatever values come back from it on the FrameEvent’s return attribute.</p><p>Frame takes advantage of the message alias capability to define a standardized pattern of starting and stopping a system:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#System

    -interface-

    start @(|&gt;&gt;|)
    stop @(|&lt;&lt;|)
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">System</span> <span class="p">{</span>

    <span class="c1">//===================== Interface Block ===================//</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&gt;&gt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">stop</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&lt;&lt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>This feature gives flexibility in naming the interface methods while maintaining a standardized internal protocol for system start/stop using <code class="language-plaintext highlighter-rouge">&gt;&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;&lt;</code>. We will revisit how these are used after introducing Transitions below.</p><h2 id="machine-block">Machine Block</h2><p>The Machine Block houses the system state machine and defines the behavior of the system. The machine block is comprised of zero or more states. If it exists, the first state is defined to be the “start state” which is what the machine’s <code class="language-plaintext highlighter-rouge">_state_</code> variable is initiazed to.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#LaMachine

    -machine-

    $Begin
##
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuG8oIb8Ld5BJC_CKghbgkQArOXLqTUqW8bmEgNafG5K0" alt="" /></p><h3 id="states">States</h3><p>State identifiers are indicated by the <code class="language-plaintext highlighter-rouge">$</code> prefix:</p><p><code class="language-plaintext highlighter-rouge">$Begin</code></p><p>In the Frame reference implementation, states are implemented as methods with this signature:</p><p><code class="language-plaintext highlighter-rouge">void state(FrameEvent e)</code></p><p>In languages that support or require it, this signature is typedef’d with a name:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">private</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">FrameState</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">);</span></code></pre></figure><p>The machine implementation must contain a private member variable for maintaining a reference to the current state:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">private</span> <span class="n">FrameState</span> <span class="n">_state_</span><span class="p">;</span></code></pre></figure><p>The <code class="language-plaintext highlighter-rouge">_state_</code> variable must be initialized in the constructor or before the object is used to the start state.</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="nf">LaMachine</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">_state_</span> <span class="p">=</span> <span class="n">_sBegin_</span><span class="p">;</span>
    <span class="p">}</span></code></pre></figure><p>After being initialized, the <code class="language-plaintext highlighter-rouge">_state_</code> variable should only be modified as part of a “transition” or “state change” (see below). Without a transition or state change, the machine will only stay in its initial state. Here is a <code class="language-plaintext highlighter-rouge">C#</code> minimal state machine:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">LaMachine</span> <span class="p">{</span>
        <span class="k">public</span> <span class="nf">LaMachine</span><span class="p">()</span> <span class="p">{</span>

            <span class="n">_state_</span> <span class="p">=</span> <span class="n">_sBegin_</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="c1">//===================== Machine Block ===================//</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sBegin_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>

        <span class="c1">//=============== Machinery and Mechanisms ==============//</span>

        <span class="k">private</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">FrameState</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">);</span>
        <span class="k">private</span> <span class="n">FrameState</span> <span class="n">_state_</span><span class="p">;</span>

    <span class="p">}</span></code></pre></figure><h3 id="event-handlers">Event Handlers</h3><p>Event Handlers are sections of code called in response to a message.</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>#Dog

    -interface-

    speak [name:string] : AudioClip

    -machine-

    $Begin
        |speak| --- Event Handler message selector
            ^       --- return
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">        <span class="c1">//===================== Machine Block ===================//</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sBegin_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"speak"</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span></code></pre></figure><p>Event handlers have two terminator tokens - return and continue.</p><div class="table-wrapper"><table><thead><tr><th>Token<th>Name<th>C# code<tbody><tr><td><code class="language-plaintext highlighter-rouge">^</code><td>return<td><code class="language-plaintext highlighter-rouge">return;</code><tr><td><code class="language-plaintext highlighter-rouge">^(42)</code><td>return value<td><code class="language-plaintext highlighter-rouge">frameEvent._return = 42;</code><br /><code class="language-plaintext highlighter-rouge">return;</code>`<tr><td><code class="language-plaintext highlighter-rouge">:&gt;</code><td>continue<td><code class="language-plaintext highlighter-rouge">break;</code></table></div><p>The basic return token simply returns from the state function while the return value variant first sets the FrameEvent’s return value. The continue token allows the code to break out of the message tests and, as we will see later, enable further processing in parent states.</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>    ...

    -machine-

    $State
        |continueEvent|
            :&gt;       --- continue terminator
        |returnEvent|
            ^       --- return terminator
        |returnValueEvent|
            ^(42)   --- return value terminator

    ...
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="c1">//===================== Machine Block ===================//</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">_sState_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"continueEvent"</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span> <span class="c1">//  continue terminator</span>
        <span class="p">}</span>

        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"returnEvent"</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span> <span class="c1">//  return terminator</span>
        <span class="p">}</span>          
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"returnValueEvent"</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="n">Return</span> <span class="p">=</span> <span class="m">42</span> <span class="c1">// --- return value terminator</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure><h3 id="calling-actions">Calling Actions</h3><p>Actions are protected methods that can be called in event handlers to implement system behavior:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>#Dog

    -interface-

    speak [name:string] : AudioClip

    -machine-

    $Begin
        |speak| speak() ^
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">        <span class="c1">//===================== Machine Block ===================//</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sBegin_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"speak"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">speak_do</span><span class="p">();</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span></code></pre></figure><p>The Framepiler appends a standard suffix (in this case <code class="language-plaintext highlighter-rouge">_do</code>) so that the interface can call actions with the same name and not have a namespace collision.</p><h3 id="transitions">Transitions</h3><p>State machines require the ability to update the <code class="language-plaintext highlighter-rouge">_state_</code> variable so as to point to a different <code class="language-plaintext highlighter-rouge">FrameState</code> method. In addition to simply switching state, transitions adhere to the following Statechart semantics:</p><ol><li>send an exit message <code class="language-plaintext highlighter-rouge">&lt;</code> to the current state<li>change the machine to the new state<li>send and enter message <code class="language-plaintext highlighter-rouge">&gt;</code> to the new state</ol><p>The <code class="language-plaintext highlighter-rouge">&lt;</code> event handler, if present, can deallocate resources and do other clean up of the state that is being exited.</p><p>The <code class="language-plaintext highlighter-rouge">&gt;</code> event handler, if present, can allocate resources and do other initialization of the state that is being entered.</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>#Dog

    -interface-

    start @(|&gt;&gt;|)
    speak
    hush

    -machine-

    $Begin
        |&gt;&gt;| -&gt; $Quiet ^

    $Quiet
        |speak| -&gt; $Barking ^

    $Barking
        |&gt;| startBarking() ^
        |&lt;| stopBarking() ^
        |hush| -&gt; $Quiet ^
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Dog</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nf">Dog</span><span class="p">()</span> <span class="p">{</span>

        <span class="n">_state_</span> <span class="p">=</span> <span class="n">_sBegin_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//===================== Interface Block ===================//</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&gt;&gt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">speak</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"speak"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">hush</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"hush"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="c1">//===================== Machine Block ===================//</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">_sBegin_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"&gt;&gt;"</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">_transition_</span><span class="p">(</span><span class="n">_sQuiet_</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">_sQuiet_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"speak"</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">_transition_</span><span class="p">(</span><span class="n">_sBarking_</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">_sBarking_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">startBarking_do</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">stopBarking_do</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"hush"</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">_transition_</span><span class="p">(</span><span class="n">_sQuiet_</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//=========== Machinery and Mechanisms ===========//</span>

    <span class="k">private</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">FrameState</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">);</span>
    <span class="k">private</span> <span class="n">FrameState</span> <span class="n">_state_</span><span class="p">;</span>


    <span class="k">private</span> <span class="k">void</span> <span class="nf">_transition_</span><span class="p">(</span><span class="n">FrameState</span> <span class="n">newState</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">FrameEvent</span> <span class="n">exitEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">exitEvent</span><span class="p">);</span>
        <span class="n">_state_</span> <span class="p">=</span> <span class="n">newState</span><span class="p">;</span>
        <span class="n">FrameEvent</span> <span class="n">enterEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
        <span class="nf">_state_</span><span class="p">(</span><span class="n">enterEvent</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure><p>Below is a complete example of system lifecycle management utilizing many of the concepts that have been introduced so far:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>#System

    -interface-

    start @(|&gt;&gt;|)
    stop @(|&lt;&lt;|)

    -machine-

    $Begin
        |&gt;&gt;| -&gt; $Working ^

    $Working
        |&lt;&lt;| -&gt; $End ^        

    $End   
##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">System</span> <span class="p">{</span>
        <span class="k">public</span> <span class="nf">System</span><span class="p">()</span> <span class="p">{</span>

            <span class="n">_state_</span> <span class="p">=</span> <span class="n">_sBegin_</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//===================== Interface Block ===================//</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&gt;&gt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">stop</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&lt;&lt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>


        <span class="c1">//===================== Machine Block ===================//</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sBegin_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"&gt;&gt;"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">_transition_</span><span class="p">(</span><span class="n">_sWorking_</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sWorking_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"&lt;&lt;"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">_transition_</span><span class="p">(</span><span class="n">_sEnd_</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sEnd_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>

        <span class="c1">//=========== Machinery and Mechanisms ===========//</span>

        <span class="k">private</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">FrameState</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">);</span>
        <span class="k">private</span> <span class="n">FrameState</span> <span class="n">_state_</span><span class="p">;</span>


        <span class="k">private</span> <span class="k">void</span> <span class="nf">_transition_</span><span class="p">(</span><span class="n">FrameState</span> <span class="n">newState</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">FrameEvent</span> <span class="n">exitEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">exitEvent</span><span class="p">);</span>
            <span class="n">_state_</span> <span class="p">=</span> <span class="n">newState</span><span class="p">;</span>
            <span class="n">FrameEvent</span> <span class="n">enterEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">enterEvent</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span></code></pre></figure><h3 id="state-changes">State Changes</h3><p>Sometimes it is desirable to change states without triggering the full enter/exit machinery involved with a transition. The state change operator enables this capability:</p><p><code class="language-plaintext highlighter-rouge">-&gt;&gt; $NewState</code></p><p>A simple filter system is a good example of when changing state is more appropriate than a full transition. Here we can see that the <code class="language-plaintext highlighter-rouge">#Filter</code> system simply oscillates between the <code class="language-plaintext highlighter-rouge">$Off</code> and <code class="language-plaintext highlighter-rouge">$On</code> states. It’s only behaivor is enabling and disabling transmission of objects through it so no state resource management is necessary:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>#Filter

    -interface-

    open
    close
    send [obj:object]

    -machine-

    $Closed
        |open| -&gt;&gt; $Open ^

    $Open
        |close| -&gt;&gt; $Closed ^

        |send| [obj:object]
            send(obj) ^

    -actions-

    send [obj:object]
##
</pre></table></code></div></div><p>Frame notates a state change <code class="language-plaintext highlighter-rouge">-&gt;&gt;</code> visually using a dashed line:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuUBY0Z9BKXMSS_ABKrCKghbgeGB-1QbvO6wqLgo2hguTL0KNLA5kT4fYSKPgIYnG1gpKIa5DsT38n3eVo86mk43Y28Lm8-1Aaq5Sg5g7rBmKe7i0" alt="" /></p><p>The implementation of the state change mechanism consists of the addition of the <code class="language-plaintext highlighter-rouge">_changeState_()</code> method that only updates the <code class="language-plaintext highlighter-rouge">_state_</code> variable (no enter/exit events) as well as its use in the event handlers:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Filter</span> <span class="p">{</span>
        <span class="k">public</span> <span class="nf">Filter</span><span class="p">()</span> <span class="p">{</span>

            <span class="n">_state_</span> <span class="p">=</span> <span class="n">_sClosed_</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//===================== Interface Block ===================//</span>

        <span class="k">public</span> <span class="k">void</span> <span class="k">on</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"on"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">off</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"off"</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">send</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">parameters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span><span class="kt">object</span><span class="p">&gt;();</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s">"obj"</span><span class="p">]</span> <span class="p">=</span> <span class="n">obj</span><span class="p">;</span>

            <span class="n">FrameEvent</span> <span class="n">e</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FrameEvent</span><span class="p">(</span><span class="s">"send"</span><span class="p">,</span><span class="n">parameters</span><span class="p">);</span>
            <span class="nf">_state_</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>


        <span class="c1">//===================== Machine Block ===================//</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sClosed_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"on"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">_changeState_</span><span class="p">(</span><span class="n">_sOpen_</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_sOpen_</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"off"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">_changeState_</span><span class="p">(</span><span class="n">_sClosed_</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Msg</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"send"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">send_do</span><span class="p">((</span><span class="kt">object</span><span class="p">)</span> <span class="n">e</span><span class="p">.</span><span class="n">Parameters</span><span class="p">[</span><span class="s">"obj"</span><span class="p">]);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//===================== Actions Block ===================//</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">send_do</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span> <span class="p">}</span>


        <span class="c1">//=========== Machinery and Mechanisms ===========//</span>

        <span class="k">private</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">FrameState</span><span class="p">(</span><span class="n">FrameEvent</span> <span class="n">e</span><span class="p">);</span>
        <span class="k">private</span> <span class="n">FrameState</span> <span class="n">_state_</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">_changeState_</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">_state_</span> <span class="p">=</span> <span class="n">newState</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="p">}</span></code></pre></figure><h3 id="branching-control-flow">Branching Control Flow</h3><p>Frame notation supports two general syntaxes for branching control flow:</p><ul><li>Boolean Tests<li>Pattern Matching</ul><p>The basic syntax for both classes of test are:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    x ?&lt;type&gt; &lt;branches&gt; : &lt;else clause&gt; ::

</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">:</code> token is “else” and <code class="language-plaintext highlighter-rouge">::</code> terminates the statement for all branching statement types.</p><p>Let’s explore the boolean test first.</p><h4 id="boolean-tests">Boolean Tests</h4><p>The basic boolean test in Frame is:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    x ? callIfTrue() : callIfFalse() ::
</pre></table></code></div></div><p>This generates this in <code class="language-plaintext highlighter-rouge">C#</code>:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">callIfTrue_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callIfFalse_do</span><span class="p">();</span>
    <span class="p">}</span></code></pre></figure><p>To reinforce the point that branching in Frame is not an expression evaluation, see how we can call multiple statements inside each branch:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>x ?
    a()
    b()
:
    c()
    d()
::
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">a_do</span><span class="p">();</span>
        <span class="nf">b_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">c_do</span><span class="p">();</span>
        <span class="nf">d_do</span><span class="p">();</span>
    <span class="p">}</span></code></pre></figure><p>To negate the test use the <code class="language-plaintext highlighter-rouge">?!</code> operator:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>x ?! callIfFalse() : callIfTrue() ::
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(!(</span><span class="n">x</span><span class="p">))</span> <span class="p">{</span>
        <span class="nf">callIfFalse_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callIfTrue_do</span><span class="p">();</span>
    <span class="p">}</span></code></pre></figure><p>Next we will explore the Frame equivalent of the switch statement for string matching.</p><h4 id="pattern-matching-statements">Pattern Matching Statements</h4><p>Frame uses a novel but easy to understand notation for switch-like statements:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>test ?&lt;type&gt;
    /pattern1/ statements :&gt;
    /pattern2/ statements :
               statements ::
</pre></table></code></div></div><p>The currently supported operators are <code class="language-plaintext highlighter-rouge">?~</code> for string matching and <code class="language-plaintext highlighter-rouge">?#</code> for number/range matching. The <code class="language-plaintext highlighter-rouge">:</code> token indicates else/default and <code class="language-plaintext highlighter-rouge">::</code> terminates the pattern matching statement.</p><h5 id="string-matching">String Matching</h5><p>The string matching statement looks like this:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>name() ?~
    /Elizabeth/ hiElizabeth()   :&gt;
    /Robert/    hiRobert()      :
                whoAreYou()     ::
</pre></table></code></div></div><p>And results in this code:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(</span><span class="nf">name_do</span><span class="p">()</span> <span class="p">==</span> <span class="s">"Elizabeth"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">hiElizabeth_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">name_do</span><span class="p">()</span> <span class="p">==</span> <span class="s">"Robert"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">hiRobert_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">whoAreYou_do</span><span class="p">();</span>
    <span class="p">}</span></code></pre></figure><p>Frame also permits multiple string matches per pattern:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>name() ?~
    /Elizabeth|Beth/ hiElizabeth()   :&gt;
    /Robert|Bob/     hiRobert()      :
                     whoAreYou()     ::
</pre></table></code></div></div><p>With this output:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(</span><span class="nf">name_do</span><span class="p">()</span> <span class="p">==</span> <span class="s">"Elizabeth"</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="nf">name_do</span><span class="p">()</span> <span class="p">==</span> <span class="s">"Beth"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">hiElizabeth_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">name_do</span><span class="p">()</span> <span class="p">==</span> <span class="s">"Robert"</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="nf">name_do</span><span class="p">()</span> <span class="p">==</span> <span class="s">"Bob"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">hiRobert_do</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">whoAreYou_do</span><span class="p">();</span>
    <span class="p">}</span></code></pre></figure><h5 id="number-matching">Number Matching</h5><p>Number matching is very similar to string pattern matching:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>n ?#
    /1/ print("It's a 1")   :&gt;
    /2/ print("It's a 2")   :
        print("It's a lot") ::
</pre></table></code></div></div><p>The output is:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="p">==</span> <span class="m">1</span><span class="p">))</span> <span class="p">{</span>
        <span class="nf">print_do</span><span class="p">(</span><span class="s">"It's a 1"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="p">==</span> <span class="m">2</span><span class="p">))</span> <span class="p">{</span>
        <span class="nf">print_do</span><span class="p">(</span><span class="s">"It's a 2"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print_do</span><span class="p">(</span><span class="s">"It's a lot"</span><span class="p">);</span>
    <span class="p">}</span></code></pre></figure><p>Frame can also pattern match multiple numbers to a single branch as well as compare decimals:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>n ?#
    /1|2/           print("It's a 1 or 2")  :&gt;
    /101.1|100.1/   print("It's over 100")  :
                    print("It's a lot")     ::
</pre></table></code></div></div><p>The output is:</p><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">n</span> <span class="p">==</span> <span class="m">2</span><span class="p">))</span> <span class="p">{</span>
        <span class="nf">print_do</span><span class="p">(</span><span class="s">"It's a 1 or 2"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="p">==</span> <span class="m">101.1</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">n</span> <span class="p">==</span> <span class="m">100.1</span><span class="p">))</span> <span class="p">{</span>
        <span class="nf">print_do</span><span class="p">(</span><span class="s">"It's over 100"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print_do</span><span class="p">(</span><span class="s">"It's a lot"</span><span class="p">);</span>
    <span class="p">}</span></code></pre></figure><h4 id="branches-and-transitions">Branches and Transitions</h4><p>The default behavior of Frame is to label transitions with the message that generated the transition. This is fine when an event handler only contains a single transition:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>#GottaBranch

  -machine-

    $A
        |e1| -&gt; $B ^

    $B

##
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuG8oIb8L71MgkMgXR2SmErehLa5Nrqx1aSiHH0D5hHJKb0sDJAnJ3I4qbqDgNWhG2000" alt="" /></p><p>However this leads to ambiguity with two or more transitions from the same event handler:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>#GottaBranch_v2

  -machine-

    $Uncertain
        |inspect|
            foo() ?
                -&gt; $True
            :
                -&gt; $False
            :: ^

    $True

    $False

##
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuG8oIb8LGlEIKujA4ZFp5AgvQg5Y8KMbgKXSjyISOWW_MYjMGLVN3g692yu2YKCqMYceAHiQcLXdvXKNf2QNG3Ye2i56ubBfa9gN0dGV0000" alt="" /></p><p>Transition labels provide clarity as to which transition is which:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>#GottaBranch_v3

  -machine-

    $Uncertain
        |inspect|
            foo() ?
                -&gt; "true foo" $True
            :
                -&gt; "foo not true" $False
            :: ^

    $True

    $False

##
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuG8oIb8LGlEIKujA4ZFp5AgvQg5Y8KMbgKXSjyISOWW_MYjMGLVN3g692yu2YKCqMYcKWAYq_7nKMQWvLY0PXRpy4h0oBeVKl1IWQm00" alt="" /></p><h2 id="declaring-actions">Declaring Actions</h2><p>Actions are declared in the <code class="language-plaintext highlighter-rouge">-actions-</code> block and observe all of the method declaration syntax discussed above. However actions do not support the alias notation:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>#Kinetic

  -actions-

  walk
  run [speed:float]
  isHurt : bool

##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Kinetic</span> <span class="p">{</span>


        <span class="c1">//===================== Actions Block ===================//</span>

        <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">walk_do</span><span class="p">()</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span> <span class="p">}</span>
        <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">run_do</span><span class="p">(</span><span class="kt">float</span> <span class="n">speed</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span> <span class="p">}</span>
        <span class="k">protected</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">isHurt_do</span><span class="p">()</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span> <span class="p">}</span>

    <span class="p">}</span></code></pre></figure><p>Frame does not (yet) support language features for actually defining useful methods. Therefore the best practice to utilize the system controller Frame emits is to create a subclass that inherits from the controller and overrides the action declarations.</p><p>Notice that the generated controller code supports a default defensive programming mechanism by throwing an exception if the base class method is called.</p><h2 id="domain-system-variables">Domain System Variables</h2><p>The final block in a Frame system specification is the <code class="language-plaintext highlighter-rouge">-domain-</code> where system level (member) variables are declared:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    &lt;var | const&gt; &lt;name&gt; : &lt;type_opt&gt; = &lt;intializer&gt;
</pre></table></code></div></div><p>Frame supports variables (<code class="language-plaintext highlighter-rouge">var</code>) which can be changed after initializations and constants (<code class="language-plaintext highlighter-rouge">const</code>) which cannot.</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>#SumData

    -domain-

    var i = 0
    var temp:float = 98.6
    const name:string = "Bob"

##
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">C#</code></p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SumData</span> <span class="p">{</span>


        <span class="c1">//===================== Domain Block ===================//</span>

        <span class="p">&lt;?&gt;</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">temp</span> <span class="p">=</span> <span class="m">98.6</span><span class="p">;</span>
        <span class="kt">string</span> <span class="n">name</span> <span class="p">=</span> <span class="s">"Bob"</span><span class="p">;</span>
    <span class="p">}</span></code></pre></figure><p>As discussed previously, variables and constants can be untyped but not uninitalized. If a type is required by a target language the Framepiler will emit a token like <code class="language-plaintext highlighter-rouge">&lt;?&gt;</code> to indicate a missing required but unspecified type.</p><h2 id="transition-parameters">Transition Parameters</h2><p>Transition parameters allow system designers to specify that data that should be sent to enter <code class="language-plaintext highlighter-rouge">|&gt;|</code> and exit <code class="language-plaintext highlighter-rouge">|&lt;|</code> event handlers during a transition.</p><p>This capability simplifies managing data passing when the current event handler shouldn’t process information in the current context.</p><h3 id="enter-event-parameters">Enter Event Parameters</h3><p>Frame provides notation to directly pass arguments to the new state as part of a transition:</p><p><code class="language-plaintext highlighter-rouge">-&gt; (&lt;enter_argument_list&gt;) $NewState</code></p><p>For instance:</p><p><code class="language-plaintext highlighter-rouge">-&gt; ("Mark") $PrintName</code></p><p>This list is sent as arguments to the enter event in the target state:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>#EnterEventParameters

    -interface-

    start @(|&gt;&gt;|)

    -machine-

    $Begin
        |&gt;&gt;| -&gt; ("Hello $State") $State ^

    $State
        |&gt;| [greeting:string]
            print(greeting) ^

    -actions-

    print[message:string]

##
</pre></table></code></div></div><h3 id="exit-event-parameters">Exit Event Parameters</h3><p>Though not as common an operation as sending data forward to the next state, Frame also enables sending data to the exit event hander of the current state as well:</p><p><code class="language-plaintext highlighter-rouge">(&lt;exit_argument_list&gt;) -&gt; $NewState</code></p><p>For instance:</p><p><code class="language-plaintext highlighter-rouge">("cya") -&gt; $NextState</code></p><p>as in</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    $OuttaHere
        |&lt;| [exitMsg:string]
            print(exitMsg) ^

        |gottaGo|
            ("cya") -&gt; $NextState ^
</pre></table></code></div></div><h2 id="state-parameters">State Parameters</h2><p>In addition to parameterizing the transition operator, Frame enables passing arguments to states themselves. State arguments are passed in an expression list after the target state identifier:</p><p><code class="language-plaintext highlighter-rouge">-&gt; $NextState(&lt;state_args&gt;)</code></p><p>State parameters are declared as a parameter list for the state:</p><p><code class="language-plaintext highlighter-rouge">$NextState [&lt;state_params&gt;]</code></p><p>Unlike transition parameters which are scoped to the enter/exit event handlers, state parameters are scoped to the lifecycle of the state itself and therefore in scope for any state event handler.</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>#StateParameters

    -interface-

    start @(|&gt;&gt;|)
    stop @(|&lt;&lt;|)

    -machine-

    $Begin
        |&gt;&gt;| -&gt; $State("Hi! I am $State :)")  ^

    $State [stateNameTag:string]
        |&gt;|  print(stateNameTag) ^
        |&lt;|  print(stateNameTag) ^
        |&lt;&lt;|
             print(stateNameTag)
             -&gt; $End ^

    $End

    -actions-

    printAll[message:string]

    -domain-

    var systemName = "#Variables"
##
</pre></table></code></div></div><p>Above we see that the <code class="language-plaintext highlighter-rouge">stateNameTag</code> is accessible in the enter, exit and stop event handlers. It will also be in scope for all other event handlers for the state as well.</p><h2 id="frame-variables">Frame Variables</h2><p>Frame has three scopes for variable declarations:</p><ul><li>System domain variables<li>State variables<li>Event handler variables</ul><h3 id="system-domain-variables">System Domain Variables</h3><p>In object-oriented terminology, domain variables are simply member variables. As such, their scope is system wide.</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>#DomainVariables

    -interface-

    start @(|&gt;&gt;|)

    -machine-

    $Begin
        |&gt;&gt;|
            print(systemWide)
            -&gt; $S0 ^

    $S0
        |&gt;|
            print(systemWide)
            -&gt; $S1 ^

    $S1
        |&gt;|
            print(systemWide)
            -&gt; $End ^            

    $End
        |&gt;|
            print(systemWide)
            -&gt; $End ^   

    -domain-

    var systemWide:string = "bigtime"
##
</pre></table></code></div></div><h2 id="state-variables">State Variables</h2><p>The next scope for declaring variables is the state. States can declare variables above the first event handler:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    ...
    $State
        var x:int = 0

        |&gt;| ^
    ...
</pre></table></code></div></div><p>State variable scope is across all event handlers for the lifecycle of the state:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>#StateVariableExample

    -interface-

    stop @(|&lt;&lt;|)

    -machine-

    $Working
        var stateName:string = "$Working"

        |&gt;| print(stateName) ^
        |&lt;| print(stateName) ^
        |&lt;&lt;| print(stateName) ^
##
</pre></table></code></div></div><p>As we can see, the state variable <code class="language-plaintext highlighter-rouge">stateName</code> stays in scope for the active lifecycle of the state, just like state parameters.</p><h2 id="event-handler-variables">Event Handler Variables</h2><p>Event handler variables are scoped to the event handler they are declared in:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>#EventHandlerVariableExample

    -machine-

    $Working
        |&gt;|
            var id:string = "12345"

            print(getFirstName(id)) ^
        |e1|
            print(getFirstName(id)) ^ --- Error!            
##
</pre></table></code></div></div><h2 id="scope-identifiers">Scope Identifiers</h2><p>If variables have unique names then Frame resolves them by searching in the following priority order for scopes for the first match:</p><ol><li>Event Handler Variables<li>Event Handler Parameters<li>State Variables<li>State Parameters<li>System Domain Variables</ol><p>To disambiguate variables with the same name in different scopes, Frame uses the following symbols:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Symbol<th>Scope<th>Example<tbody><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">||.&lt;id&gt;</code><td>Event Handler Variable<td><code class="language-plaintext highlighter-rouge">||.d</code><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">||[&lt;id&gt;]</code><td>Event Handler Parameter<td><code class="language-plaintext highlighter-rouge">||[c]</code><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">$.&lt;id&gt;</code><td>State Variable<td><code class="language-plaintext highlighter-rouge">$.b</code><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">$[&lt;id&gt;]</code><td>State Parameter<td><code class="language-plaintext highlighter-rouge">$[a]</code><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">#.&lt;id&gt;</code><td>System Variable<td><code class="language-plaintext highlighter-rouge">#.e</code></table></div><p>Here we can see the use of each of these scope identifiers:</p><p><code class="language-plaintext highlighter-rouge">Frame</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>#ScopeIdentifiers

    -interface-

    start @(|&gt;&gt;|)

    -machine-

    $Begin
        |&gt;&gt;| -&gt; (2) $Scopes(4) ^

    $Scopes[d:int] --- 4

        var c:int = 3

        |&gt;| [b:int] --- 2

            var a:int = 1

            output(||.a ||[b] $.c $[d] #.e) ^

    -actions-

    output[a:int b:int c:int d:int e:int]

    -domain-

    var e:int = 5
##
</pre></table></code></div></div><p>You can see the generated controller here:</p><iframe width="100%" height="475" src="https://dotnetfiddle.net/Widget/AH20m9" frameborder="0"></iframe></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hello_worlds_part_3/">Hello Worlds - Part 3</a><li><a href="/posts/gotta_branch/">Gotta Branch</a><li><a href="/posts/history_of_states/">The History of States (there won't be a quiz) </a><li><a href="/posts/hello_worlds_part_1/">Hello Worlds - Part 1</a><li><a href="/posts/what_is_frame/">What is Frame?</a></ul></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">Mark Truluck</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
